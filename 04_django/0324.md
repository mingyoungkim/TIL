# Django

## 03월 24일

### Model Relationship ☝

> A many-to-one relationship in RDBMS (1:N)

- Foreign Key (외래키)

  - RDBMS(관계형데이터베이스)에서 한 테이블의 필드(Comment) 중 

    다른 테이블의 행(Article)을 식별할 수 있는 키

  - 참조하는 테이블(Comment)에서 1개의 키에 해당하고 

    참조되는 측의 테이블(Article)의 기본키를 가리킴

  - 참조하는 테이블 여러개가 참조되는 테이블 1개의 동일한 행을 같이 참조할 수 있다.

    (게시글 행 하나를 여러개의 댓글행이 참조 가능)

  - 키를 사용해 부모 테이블의 유일한 값을 참조 (참조 무결성) => PK

- ForeignKey()

  - django에서 1:N을 표현하기 위한 model field

  - 2개의 필수 위치 인자

    - 참조하는 모델 클래스

    - on_delete 옵션

      - 게시글이 삭제된 경우 그 게시글에 해당하는 댓글들을 어떻게 처리할지 정의

        (데이터 무결성을 위해 매우 중요한 설정)

        => 데이터의 정확성과 일관성을 유지 보수

      - CASCADE : 부모 객체(참조된 객체)가 삭제 됐을 때 이를 참조하는 객체도 삭제

      - PROTEXT, SET_NULL, DO_NOTHING 등등

  - related_name

    - _set manager를 변경할 이름 설정
    - article.comment_set.all() => article.comments.all()
    - 이렇게 바꾸면 comment_set은 사용 불가
    - 1:N 관계에선 거의 사용 안함!! **M:N 관계에서 반드시 사용**

```python
class Comment(models.Model):
    # 외래키의 변수명은 얘가 참조하는 모델의 소문자로 써줌
    # ForeignKey 필수 인자 2개 (참조하는애, on_delete)
    article = models.ForeignKey(
        Article,
        on_delete=models.CASCADE,
        related_name = 'comments',
    )
```



> 1:N model manager

- Comment(N)이 Article(1) 을 참조

  `comment.article`

- Article(1)이 Comment(N)을 역참조

  (django에서는 역참조시 모델이름_set형식의 managet생성)

  `article.comment_set.all()`

- 

